\hypertarget{_reflection_8h_source}{}\doxysection{Reflection.\+h}
\label{_reflection_8h_source}\index{D:/TL/Vscode/VsCode\_C/Learn\_opengl/src/Engine/Framework/Tools/Reflection.h@{D:/TL/Vscode/VsCode\_C/Learn\_opengl/src/Engine/Framework/Tools/Reflection.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#include "{}Singleton.h"{}}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{keyword}{typedef} \textcolor{keywordtype}{void}* (*CreateObjectFunc)(void);}
\DoxyCodeLine{9 \textcolor{keyword}{typedef} std::shared\_ptr<void>(*GetInstanceFunc)(void);}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{//反射注册宏}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#define REFLECTION(className,tag)                                                   \(\backslash\)}}
\DoxyCodeLine{13 \textcolor{preprocessor}{    className *Creator\#\#className()                                                 \(\backslash\)}}
\DoxyCodeLine{14 \textcolor{preprocessor}{    \{                                                                               \(\backslash\)}}
\DoxyCodeLine{15 \textcolor{preprocessor}{        return new className;                                                       \(\backslash\)}}
\DoxyCodeLine{16 \textcolor{preprocessor}{    \}                                                                               \(\backslash\)}}
\DoxyCodeLine{17 \textcolor{preprocessor}{    RegisterAction registerAction\#\#className(                                       \(\backslash\)}}
\DoxyCodeLine{18 \textcolor{preprocessor}{        \#className,new Reflection(\#className,(CreateObjectFunc)Creator\#\#className,ReflectionTag::\#\#tag))}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{comment}{//静态反射注册宏}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define REFLECTIONINSTANCE(className,tag)                                           \(\backslash\)}}
\DoxyCodeLine{22 \textcolor{preprocessor}{    className *Creator\#\#className()                                                 \(\backslash\)}}
\DoxyCodeLine{23 \textcolor{preprocessor}{    \{                                                                               \(\backslash\)}}
\DoxyCodeLine{24 \textcolor{preprocessor}{        return new className;                                                       \(\backslash\)}}
\DoxyCodeLine{25 \textcolor{preprocessor}{    \}                                                                               \(\backslash\)}}
\DoxyCodeLine{26 \textcolor{preprocessor}{    std::shared\_ptr<void> Instance\#\#className()                                     \(\backslash\)}}
\DoxyCodeLine{27 \textcolor{preprocessor}{    \{                                                                               \(\backslash\)}}
\DoxyCodeLine{28 \textcolor{preprocessor}{        static std::shared\_ptr<void> instance;                                      \(\backslash\)}}
\DoxyCodeLine{29 \textcolor{preprocessor}{        if (!instance)                                                              \(\backslash\)}}
\DoxyCodeLine{30 \textcolor{preprocessor}{            instance = std::shared\_ptr<className>(new className());                 \(\backslash\)}}
\DoxyCodeLine{31 \textcolor{preprocessor}{        return instance;                                                            \(\backslash\)}}
\DoxyCodeLine{32 \textcolor{preprocessor}{    \}                                                                               \(\backslash\)}}
\DoxyCodeLine{33 \textcolor{preprocessor}{    RegisterAction registerAction\#\#className(                                       \(\backslash\)}}
\DoxyCodeLine{34 \textcolor{preprocessor}{        \#className,new Reflection(\#className,(CreateObjectFunc)Creator\#\#className,ReflectionTag::\#\#tag,Instance\#\#className))}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{keyword}{enum class} ReflectionTag}
\DoxyCodeLine{37 \{}
\DoxyCodeLine{38     \mbox{\hyperlink{class_component}{Component}},}
\DoxyCodeLine{39     \mbox{\hyperlink{class_game_object}{GameObject}},}
\DoxyCodeLine{40     \mbox{\hyperlink{class_material}{Material}}}
\DoxyCodeLine{41 \};}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_reflection}{Reflection}}}
\DoxyCodeLine{44 \{}
\DoxyCodeLine{45     std::string className;}
\DoxyCodeLine{46     CreateObjectFunc createF;}
\DoxyCodeLine{47     GetInstanceFunc getInstance;}
\DoxyCodeLine{48     ReflectionTag tag;}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \mbox{\hyperlink{struct_reflection}{Reflection}}(std::string name, CreateObjectFunc func, ReflectionTag \_tag, GetInstanceFunc instance=\textcolor{keyword}{nullptr})}
\DoxyCodeLine{51         :className(name), createF(func), tag(\_tag), getInstance(instance)}
\DoxyCodeLine{52     \{\}}
\DoxyCodeLine{53 \};}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{comment}{//反射类}}
\DoxyCodeLine{56 \textcolor{keyword}{class }\mbox{\hyperlink{class_reflection_manager}{ReflectionManager}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_singleton}{Singleton}}<ReflectionManager>}
\DoxyCodeLine{57 \{}
\DoxyCodeLine{58 \textcolor{keyword}{private}:}
\DoxyCodeLine{59     std::map<std::string, Reflection*> classMap;}
\DoxyCodeLine{60     std::vector<std::string> members;}
\DoxyCodeLine{61     std::multimap<ReflectionTag, std::string> memberByTag;}
\DoxyCodeLine{62 \textcolor{keyword}{public}:}
\DoxyCodeLine{63     \mbox{\hyperlink{class_reflection_manager}{ReflectionManager}}();}
\DoxyCodeLine{64     \textcolor{keywordtype}{void}* CreateClassByName(std::string className);}
\DoxyCodeLine{65     std::shared\_ptr<void> GetInstanceByName(std::string className);}
\DoxyCodeLine{66     \textcolor{keyword}{const} std::vector<std::string>\& GetAllMember()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} members; \}}
\DoxyCodeLine{67     \textcolor{keywordtype}{void} RegistClass(std::string name, \mbox{\hyperlink{struct_reflection}{Reflection}}* method);}
\DoxyCodeLine{68     }
\DoxyCodeLine{69     \textcolor{keyword}{const} std::multimap<ReflectionTag, std::string>::iterator GetMemberStartByTag(ReflectionTag tag) \{ \textcolor{keywordflow}{return} memberByTag.find(tag); \}}
\DoxyCodeLine{70     \textcolor{keyword}{const} \textcolor{keywordtype}{int} GetMemberCountByTag(ReflectionTag tag)\textcolor{keyword}{const }\{ \textcolor{keywordflow}{return} memberByTag.count(tag); \}}
\DoxyCodeLine{71 \};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{comment}{//注册动作类}}
\DoxyCodeLine{74 \textcolor{keyword}{class }\mbox{\hyperlink{class_register_action}{RegisterAction}}}
\DoxyCodeLine{75 \{}
\DoxyCodeLine{76 \textcolor{keyword}{public}:}
\DoxyCodeLine{77     \mbox{\hyperlink{class_register_action}{RegisterAction}}(std::string className, \mbox{\hyperlink{struct_reflection}{Reflection}}* ptrCreateFn)}
\DoxyCodeLine{78     \{}
\DoxyCodeLine{79         ReflectionManager::instance().RegistClass(className, ptrCreateFn);}
\DoxyCodeLine{80     \}}
\DoxyCodeLine{81 \};}
\DoxyCodeLine{82 }
\DoxyCodeLine{83 }

\end{DoxyCode}
